{% extends "base.html" %}

{% block title %}{{ table_name }} - Map View | CCT-Roan Project Beta{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="hero-section">
    <h1 class="hero-title">
        <i class="fas fa-map-marked-alt" style="color: var(--primary-teal);"></i> 
        {{ table_name }} Map View
    </h1>
    <p class="hero-subtitle">
        Explore {{ total_count }} spatial features on an interactive map
    </p>
</div>

<!-- Navigation Bar -->
<div class="search-section" style="padding: 1.5rem; margin-bottom: 2rem;">
    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
        <div style="display: flex; gap: 1rem; align-items: center;">
            <a href="/table/{{ table_name }}" class="btn-outline" style="text-decoration: none;">
                <i class="fas fa-table"></i> Table View
            </a>
            <a href="/" class="btn-outline" style="text-decoration: none;">
                <i class="fas fa-arrow-left"></i> Back to Overview
            </a>
        </div>
        <div style="display: flex; gap: 1rem; align-items: center;">
            {% if filter_query and filter_type == 'search' %}
            <div style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: rgba(26, 188, 156, 0.1); border-radius: 6px; border: 1px solid var(--primary-teal);">
                <i class="fas fa-filter" style="color: var(--primary-teal);"></i>
                <span style="color: var(--dark-teal); font-weight: 500;">Filtered: "{{ filter_query }}"</span>
                <button id="toggle-filter-btn" class="btn-outline" style="padding: 0.25rem 0.5rem; font-size: 0.8rem; margin-left: 0.5rem;">
                    <i class="fas fa-eye" id="filter-icon"></i> <span id="filter-text">Show All</span>
                </button>
            </div>
            {% endif %}
            <button id="fit-bounds-btn" class="btn-primary" style="border: none;">
                <i class="fas fa-expand-arrows-alt"></i> Fit All
            </button>
            <button id="toggle-layers" class="btn-outline" style="border: 2px solid var(--border-light);">
                <i class="fas fa-layer-group"></i> Layers
            </button>
        </div>
    </div>
</div>

<!-- Stats Section -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
    <div class="data-card" style="text-align: center; padding: 1.5rem;">
        <div class="stat-item" style="flex-direction: column; gap: 0.5rem;">
            <i class="fas fa-database stat-icon" style="font-size: 2rem;"></i>
            <h3 style="color: var(--primary-teal); margin: 0; font-weight: 700;">{{ total_count }}</h3>
            <span style="color: var(--text-light); font-weight: 500;">Total Features</span>
        </div>
    </div>
    <div class="data-card" style="text-align: center; padding: 1.5rem;">
        <div class="stat-item" style="flex-direction: column; gap: 0.5rem;">
            <i class="fas fa-map stat-icon" style="font-size: 2rem;"></i>
            <h3 id="map-status" style="color: var(--accent-teal); margin: 0; font-weight: 700;">Loading...</h3>
            <span style="color: var(--text-light); font-weight: 500;">Map Status</span>
        </div>
    </div>
    <div class="data-card" style="text-align: center; padding: 1.5rem;">
        <div class="stat-item" style="flex-direction: column; gap: 0.5rem;">
            <i class="fas fa-globe stat-icon" style="font-size: 2rem;"></i>
            <h3 style="color: var(--dark-teal); margin: 0; font-weight: 700;">WGS 84</h3>
            <span style="color: var(--text-light); font-weight: 500;">Coordinate System</span>
        </div>
    </div>
</div>

<!-- Interactive Map -->
<div class="data-card" style="padding: 0; overflow: hidden;">
    <div style="background: var(--primary-teal); color: var(--white); padding: 1.5rem; display: flex; justify-content: space-between; align-items: center;">
        <h4 style="margin: 0; font-weight: 600;">
            <i class="fas fa-globe"></i> Interactive Map
        </h4>
        <div style="display: flex; gap: 0.75rem;">
            <a href="/download/shapefile/{{ table_name }}" class="btn-outline" style="text-decoration: none; color: var(--white); border-color: rgba(255,255,255,0.3);">
                <i class="fas fa-download"></i> Shapefile
            </a>
            <a href="/api/geojson/{{ table_name }}" class="btn-outline" style="text-decoration: none; color: var(--white); border-color: rgba(255,255,255,0.3);" target="_blank">
                <i class="fas fa-code"></i> GeoJSON
            </a>
        </div>
    </div>
    <div style="height: 600px; width: 100%;">
        <div id="map"
             data-table-name="{{ table_name }}"
             data-filter-query="{{ filter_query | safe }}"
             data-filter-type="{{ filter_type | safe }}"
             style="height: 100%; width: 100%; border-radius: 0 0 16px 16px;"></div>
    </div>
</div>

<!-- Feature Info Panel -->
<div class="data-card" id="feature-info" style="display: none; margin-top: 2rem;">
    <div class="card-header">
        <h4 class="card-title">
            <i class="fas fa-info-circle stat-icon"></i> Feature Information
        </h4>
    </div>
    <div style="margin-top: 1rem;">
        <div id="feature-details"></div>
    </div>
</div>

</div>
{% endblock %}

{% block scripts %}
<!-- Google Maps API -->
<script
    src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&callback=initMap"
    async defer></script>

<!-- Custom Map Logic -->
<script src="{{ url_for('static', filename='js/map.js') }}"></script>

<style>
/* Custom styles for Google Maps integration */
#map {
    border-radius: 0 0 0.375rem 0.375rem;
}
</style>
{% endblock %}
